{% extends 'website/common/template.html' %}
{% load static %}
{% load custom_tags %}
{% block content %}
	<section class="container">
		<div class="category-list">
			<div class="inner">
				<!-- ì¹´í…Œê³ ë¦¬ë³„ ë‰´ìŠ¤ -->
				<ul class="sub-menu category show">
					<li class="active"><a href="javascript:;">ì¤‘ê³ ì°¨ ë‰´ìŠ¤</a></li>
					<li><a href="javascript:;">ì‹ ì°¨ ë‰´ìŠ¤</a></li>
					<li><a href="javascript:;">ì‹œìŠ¹ê¸°</a></li>
					<li><a href="javascript:;">ìë™ì°¨ ì—…ê³„ ë‰´ìŠ¤</a></li>
				</ul>
				<!-- ì–¸ë¡ ì‚¬ë³„ ë‰´ìŠ¤ -->
				<ul class="sub-menu media">
					<li class="active"><a href="javascript:;">ì˜¤í† í—¤ëŸ´ë“œ</a></li>
					<li><a href="javascript:;">ë°ì¼ë¦¬ì¹´</a></li>
					<li><a href="javascript:;">ì˜¤í† ë·°</a></li>
					<li><a href="javascript:;">ITì¡°ì„ </a></li>
					<li><a href="javascript:;">ì˜¤í† ëª¨ë‹</a></li>
					<li><a href="javascript:;">ì˜¤í† ë‹¤ì´ì–´ë¦¬</a></li>
					<li><a href="javascript:;">ì¹´ê°€ì´</a></li>
					<li><a href="javascript:;">ë”ë“œë¼ì´ë¸Œ</a></li>
				</ul>
				<!-- ê²€ìƒ‰ -->
				<div class="result-info">
					<p>"<span></span>"ì— ëŒ€í•œ ê²€ìƒ‰ê²°ê³¼ê°€ ì´ <strong></strong>ê±´ ìˆìŠµë‹ˆë‹¤.</p>
					<a href="javascript:;" onclick="loadNewsList(0, 'category', 0, 12, 'default', 'change');"><span>ğŸ”™</span> ëŒì•„ê°€ê¸°</a>
				</div>
			</div>
		</div>
		<div class="item-list">
			<div class="inner">
				<div class="list-top">
					<p class="txt-guide">* ë‰´ìŠ¤ ê¸°ì‚¬ë¥¼ í´ë¦­í•˜ë©´ í•´ë‹¹ ë‰´ìŠ¤ë¡œ ì´ë™ë©ë‹ˆë‹¤.</p>
					{% comment %} 
					ëª©ë¡ íƒ€ì… (ìŠ¤íƒ€ì¼) ë³€ê²½
					<div class="list-type">
						<button type="button" class="btn type01 active"></button>
						<button type="button" class="btn type02"></button>
					</div> 
					{% endcomment %}
				</div>
				<ul class="news-group show"></ul>
			</div>
		</div>
	</section>
	<div class="loading" style="display:block;">
		<div class="dim"></div>
		<div class="loading-box">
			<div class="out-box">
				<i class="in-box"></i>
			</div>
			<p>
				ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤.<br>
				(ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.)
			</p>
		</div>
	</div>
</div>

<!-- Javascript -->
<script type="text/javascript" src="{% static 'js/jquery-1.12.4.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/jquery-ui.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/swiper.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/common.js' %}"></script>
<script>
var connFlag = false;
$(function(){
	//ìµœì´ˆ ëª©ë¡
	loadNewsList(0, 'category', 0, 12);
	$('#wrap').addClass('category');
	//ì¹´í…Œê³ ë¦¬ í´ë¦­
	$('.category-list ul li a').on('click', function(){
		var choicedListType = $(this).closest('.sub-menu').hasClass('category') ? 'category' : 'media'
		$('#wrap').prop('class', '').addClass(choicedListType);
		if(!connFlag){
			var idx = $(this).parent('li').index();
			var categoryBeforeCurrIdx = $('.category-list ul li.active').index();
			if(idx !== categoryBeforeCurrIdx){
				$(this).closest('ul').find('li').removeClass('active');
				$(this).parent('li').addClass('active');
				if($(this).closest('ul').hasClass('category')){
					loadNewsList(idx, 'category', 0, 12);
				}else if($(this).closest('ul').hasClass('media')){
					loadNewsList(idx, 'media', 0, 12);
				}
			}
			
		}
	});
	//ì¢‹ì•„ìš”(ì°œ)
	$(document).on('click', '.item-list ul li .btn-like', function(){
		alert('ì¹´ë‰´ìŠ¤.zip íšŒì› ì „ìš© ê¸°ëŠ¥ì…ë‹ˆë‹¤.');
		location.href='/login';
	});
	//ìŠ¤í¬ë¡¤ ë¡œë“œ (í˜ì´ì§•)
	$(window).on('scroll', function(e){
		if(($(window).innerHeight() + $(window).scrollTop()) >= $('body').height()) {
			if(!connFlag){
				var thisCategory = $('.sub-menu.show li.active').index();
				var thisNewsType = $('#wrap').prop('class');
				var nowListLength = $('.news-group li').length;
				if($('#wrap').hasClass('search-result')){
					var keyword = $('#search_keyword').val();
					loadNewsList(99, 'all', nowListLength, 12, 'more', null, keyword);
				}else{
					loadNewsList(thisCategory, thisNewsType, nowListLength, 12, 'more');
				}
			}
		}
	});
});
	
//news list > view count
function viewCountUp(idx, nowCount, newsCode){
	$.ajax({
		url: '{% url "view_count" %}',
		type: 'GET',
		data: {
			'now_count': nowCount,
			'news_code': newsCode
		},
		dataType: 'json',
		success: function(data){
			$('.news-group.show li').eq(idx).find('.view-cnt').children('strong').text(data);
		}
	});
}
//news load
function loadNewsList(idx, list_type, start_idx, load_length, load_type, fnc_type, search_keyword){
	console.log('@@@', list_type)
	$('.loading').show();
	connFlag = true;
	$.ajax({
		url: '{% url "list_data" %}',
		type: 'GET',
		data: {
			'list_idx': idx,
			'list_type': list_type,
			'start_idx': start_idx,
			'load_length': load_length,
			'search_keyword': search_keyword
		},
		dataType: 'json',
		success: function(data){
			$('.loading').hide();
			var newsItem = "";		
			json_data = JSON.parse(data.news)
			total_length = data.total_length
			console.log(total_length)
			for(i = 0; i < json_data.length; i++){
				list = json_data[i].fields;
				var media_name = '';
				if(list.media_code == '100'){
					media_name = 'ah'
				}else if(list.media_code == '200'){
					media_name = 'daily'
				}else if(list.media_code == '300'){
					media_name = 'auto-view'
				}else if(list.media_code == '400'){
					media_name = 'chosun'
				}else if(list.media_code == '500'){
					media_name = 'auto-morning'
				}else if(list.media_code == '600'){
					media_name = 'auto-diary'
				}else if(list.media_code == '700'){
					media_name = 'carguy'
				}else if(list.media_code == '800'){
					media_name = 'drive'
				}
				newsItem += '<li data-news-code="' + list.news_code + '">';
				newsItem += '<a href="' + list.news_url + '" target="_blank" title="' + list.news_title + '">';
				if(list.media_code == '200' || /*list.media_code == '500' ||*/ list.news_img_url == 'None' || list.news_img_url == ''){
					newsItem += '<div class="picture">';
					newsItem += '<p><span class="ico">ğŸ˜°</span><br>í•´ë‹¹ ì–¸ë¡ ì‚¬ì—ì„œ<br>ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
					newsItem += '</div>';
				}else{
					newsItem += '<div class="picture" style="background:url(\'' + list.news_img_url + '\') no-repeat center; background-size:cover;"></div>';
				}
				newsItem += '<div class="info-box">';
				newsItem += '<div class="tags">';
				if(list.write_date == '{{ today_date|escapejs }}'){
					newsItem += '<span class="today">TODAY</span>';
				}
				newsItem += '<span class="'+ media_name +'">' + list.media_name + '</span>';
				newsItem += '</div>';
				newsItem += '<p class="subject">' + list.news_title + '</p>';
				newsItem += '<p class="summary">' + list.news_summary + '</p>';
				newsItem += '</div>';
				newsItem += '</a>';
				newsItem += '<div class="infos">';
				newsItem += '<span class="date">' + list.write_date + '</span>';
				newsItem += '<span class="view-cnt" title="ì´ ê¸°ì‚¬ ì¡°íšŒìˆ˜">ğŸ‘ <strong>' + list.view_count + '</strong></span>'
				newsItem += '<button type="button" class="btn-like" title="ì´ ê¸°ì‚¬ ì°œí•˜ê¸°">ğŸ‘ <strong>0</strong></button>';
				newsItem += '</div>';
				newsItem += '</li>';
			}
			if(load_type == 'more'){
				$('.news-group').append(newsItem);
				var nowScrollTop = $('html, body').scrollTop();
				$('html, body').animate({scrollTop: nowScrollTop + 100}, 150);
			}else{
				$('.news-group').html(newsItem);
				$('document, html').scrollTop(0);
			}

			if(load_type == 'search'){
				var keyword = $('#search_keyword').val();
				$('.result-info p span').text(keyword);
				$('.result-info p strong').text(total_length);
				$('.category-list .sub-menu').removeClass('show');
				$('.category-list .result-info').addClass('show');
			}

			//sub menu
			console.log(list_type)
			if(fnc_type == 'change'){
				$('.category-list ul').removeClass('show');
				$('.category-list ul li').removeClass('active');
				$('.category-list .result-info').removeClass('show');

				if(list_type == 'category'){
					$('#wrap').prop('class', '').addClass('category');
					$('.category-list ul.category').addClass('show');
				}else if(fnc_type == 'media'){
					$('#wrap').prop('class', '').addClass('media');
					$('.category-list ul.media').addClass('show');
				}
				$('.category-list ul.sub-menu.show li').eq(0).addClass('active');
			}

			//close gnb box
			$('.header .btn-gnb').removeClass('active');
			$('.gnb-box, .header .fncs').removeClass('show');
			connFlag = false;
		},
		error : function(request, status, error){
			console.log(error)
		},
	});
}
</script>
</body>
</html>
{% endblock %}